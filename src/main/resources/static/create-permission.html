<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø¬ÙˆØ² Ø¬Ø¯ÛŒØ¯</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        h2 { color: #0056b3; }
        form div { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"] { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        button { padding: 10px 20px; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; }
        button:hover { background-color: #218838; }
        .message-container { margin-top: 15px; padding: 10px; border-radius: 5px; font-weight: bold; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        a { display: inline-block; margin-top: 20px; padding: 10px 15px; background-color: #007bff; color: white; text-decoration: none; border-radius: 5px; }
        a:hover { background-color: #0056b3; }
    </style>
</head>
<body>
<h2>Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø¬ÙˆØ² Ø¬Ø¯ÛŒØ¯</h2>

<div id="messageDisplay" class="message-container">
    <p></p>
</div>

<form id="createPermissionForm">
    <div>
        <label for="permissionName">Ù†Ø§Ù… Ù…Ø¬ÙˆØ² (Ù…Ø«Ø§Ù„: VIEW_PRODUCTS):</label>
        <input type="text" id="permissionName" name="name" required>
    </div>
    <button type="submit">Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø¬ÙˆØ²</button>
</form>

<br>
<a href="/user-list.html">â¬…ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</a>
<br>
<a href="/create-role.html">â• Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù‚Ø´ Ø¬Ø¯ÛŒØ¯</a>
<br>
<a href="/manage-user-menus.html">ğŸ› ï¸ Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ù‚Ø´ Ùˆ Ù…Ù†ÙˆÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</a>


<script>
    // ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
    function showMessage(msg, type) {
        const messageDisplay = document.getElementById('messageDisplay');
        const messageParagraph = messageDisplay.querySelector('p');
        messageParagraph.innerText = msg;
        messageDisplay.className = 'message-container'; // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§
        if (type) {
            messageDisplay.classList.add(type); // Ø§ÙØ²ÙˆØ¯Ù† Ú©Ù„Ø§Ø³ success ÛŒØ§ error
        }
    }

    // Event Listener Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ ÙØ±Ù…
    document.getElementById('createPermissionForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ ÙØ±Ù…

        const permissionName = document.getElementById('permissionName').value;

        // Ø³Ø§Ø®Øª Ø´ÛŒØ¡ Ø¯Ø±Ø®ÙˆØ§Ø³Øª JSON
        const permissionData = {
            name: permissionName.trim() // Ø­Ø°Ù ÙØ§ØµÙ„Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ
        };

        // Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø§Ù„ÛŒ Ø¨ÙˆØ¯Ù† Ù†Ø§Ù…
        if (!permissionData.name) {
            showMessage('âŒ Ù†Ø§Ù… Ù…Ø¬ÙˆØ² Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯.', 'error');
            return;
        }

        // Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª POST Ø¨Ù‡ API
        fetch('/api/permissions', { // Ù…Ø³ÛŒØ± API Ú©Ù‡ Ø¯Ø± PermissionController ØªØ¹Ø±ÛŒÙ Ú©Ø±Ø¯ÛŒÙ…
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(permissionData)
        })
            .then(response => {
                if (response.ok) {
                    return response.text(); // Ø§Ú¯Ø± Ø¨Ú©â€ŒØ§Ù†Ø¯ Ù¾ÛŒØ§Ù… Ù…ØªÙ†ÛŒ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯
                } else {
                    return response.text().then(errorMessage => {
                        throw new Error(errorMessage || 'Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø¬ÙˆØ²'); // Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ Ø§Ø² Ø¨Ú©â€ŒØ§Ù†Ø¯
                    });
                }
            })
            .then(message => {
                showMessage(message, 'success');
                document.getElementById('createPermissionForm').reset(); // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† ÙØ±Ù… Ø¨Ø¹Ø¯ Ø§Ø² Ù…ÙˆÙÙ‚ÛŒØª
            })
            .catch(error => {
                showMessage('âŒ ' + error.message, 'error');
                console.error('Error creating permission:', error);
            });
    });

    // Ù‡Ù†Ú¯Ø§Ù… Ù„ÙˆØ¯ Ø´Ø¯Ù† ØµÙØ­Ù‡ØŒ Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ù„ÙˆØ¯ Ù†ÛŒØ³Øª
    window.onload = function() {
        // Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§ÛŒÙ†Ø¬Ø§ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯ Ø§Ú¯Ø± Ø§Ø² redirect Ø¢Ù…Ø¯Ù‡â€ŒØ§ÛŒØ¯
        showMessage('', '');
    };
</script>
</body>
</html>