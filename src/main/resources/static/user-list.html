<!-- user-list.html -->
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</title>
</head>
<body>
<h2>Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h2>

<table border="1">
    <thead>
    <tr>
        <th>Ø´Ù†Ø§Ø³Ù‡</th>
        <th>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</th>
        <th>Ù†Ù‚Ø´â€ŒÙ‡Ø§</th>
        <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
    </tr>
    </thead>
    <tbody id="userTableBody">
    <!-- Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ© Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´Ù† -->
    </tbody>
</table>

<p id="message"></p>

<a href="create-user.html">â• Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</a>

<script>
    function loadUsers() {
        fetch('/admin/users')
            .then(response => response.json())
            .then(data => {
                const tbody = document.getElementById('userTableBody');
                tbody.innerHTML = ''; // Ù¾Ø§Ú©â€ŒÚ©Ø±Ø¯Ù† Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯
                data.forEach(user => {
                    const tr = document.createElement('tr');

                    tr.innerHTML = `
                        <td>${user.id}</td>
                        <td>${user.username}</td>
                        <td>${user.roles.join(', ')}</td>
                        <td>
                            <button onclick="deleteUser(${user.id})">ğŸ—‘ Ø­Ø°Ù</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            })
            .catch(error => {
                document.getElementById('message').innerText = 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†';
                console.error(error);
            });
    }

    function deleteUser(id) {
        if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ')) {
            fetch(`/admin/users/${id}`, {
                method: 'DELETE'
            })
                .then(response => {
                    if (response.ok) {
                        document.getElementById('message').innerText = 'âœ… Ú©Ø§Ø±Ø¨Ø± Ø­Ø°Ù Ø´Ø¯';
                        loadUsers(); // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯
                    } else {
                        document.getElementById('message').innerText = 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ú©Ø§Ø±Ø¨Ø±';
                    }
                });
        }
    }

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
    loadUsers();
</script>
</body>
</html>
