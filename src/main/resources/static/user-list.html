<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        h2 { color: #0056b3; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background-color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        th, td { padding: 12px 15px; text-align: right; border-bottom: 1px solid #ddd; }
        th { background-color: #007bff; color: white; font-weight: bold; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        button { background-color: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 0.9rem; }
        button:hover { background-color: #c82333; }
        a { display: inline-block; margin-top: 20px; padding: 10px 15px; background-color: #28a745; color: white; text-decoration: none; border-radius: 5px; }
        a:hover { background-color: #218838; }
        #message { margin-top: 15px; padding: 10px; border-radius: 5px; font-weight: bold; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
<h2>Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h2>

<table border="1">
    <thead>
    <tr>
        <th>Ø´Ù†Ø§Ø³Ù‡</th>
        <th>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</th>
        <th>Ù†Ù‚Ø´â€ŒÙ‡Ø§</th>
        <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
    </tr>
    </thead>
    <tbody id="userTableBody">
    </tbody>
</table>

<p id="message"></p>

<a href="create-user.html">â• Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</a>
<br>
<a href="manage-user-menus.html">ğŸ› ï¸ Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ù‚Ø´ Ùˆ Ù…Ù†ÙˆÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</a>


<script>
    // ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
    function showMessage(msg, type) {
        const messageElement = document.getElementById('message');
        messageElement.innerText = msg;
        messageElement.className = ''; // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ

        // ÙÙ‚Ø· Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ 'type' Ø®Ø§Ù„ÛŒ Ù†Ø¨Ø§Ø´Ø¯ØŒ Ú©Ù„Ø§Ø³ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
        if (type) {
            messageElement.classList.add(type);
        }
    }

    function loadUsers() {
        // Ù…Ø³ÛŒØ± API Ø±Ø§ Ø¨Ù‡ /api/users ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯
        fetch('/api/users')
            .then(response => {
                if (!response.ok) { // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù¾Ø§Ø³Ø® HTTP
                    throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†: ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                const tbody = document.getElementById('userTableBody');
                tbody.innerHTML = ''; // Ù¾Ø§Ú©â€ŒÚ©Ø±Ø¯Ù† Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯
                if (data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4">Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</td></tr>';
                } else {
                    data.forEach(user => {
                        const tr = document.createElement('tr');

                        tr.innerHTML = `
                            <td>${user.id}</td>
                            <td>${user.username}</td>
                            <td>${user.roles.join(', ')}</td>
                            <td>
                                <button onclick="deleteUser(${user.id})">ğŸ—‘ Ø­Ø°Ù</button>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                }
                showMessage('', ''); // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù¾ÛŒØ§Ù… Ù‚Ø¨Ù„ÛŒ Ø¯Ø± ØµÙˆØ±Øª Ù…ÙˆÙÙ‚ÛŒØª
            })
            .catch(error => {
                showMessage('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†: ' + error.message, 'error');
                console.error(error);
            });
    }

    function deleteUser(id) {
        if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ')) {
            // Ù…Ø³ÛŒØ± API Ø±Ø§ Ø¨Ù‡ /api/users/${id} ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯
            fetch(`/api/users/${id}`, {
                method: 'DELETE'
            })
                .then(response => {
                    if (response.ok) {
                        showMessage('âœ… Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯', 'success');
                        loadUsers(); // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯
                    } else {
                        // Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ØŒ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ Ø±Ø§ Ø§Ø² Ø¨Ø¯Ù†Ù‡ Ù¾Ø§Ø³Ø® API Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯
                        response.text().then(errorMessage => {
                            showMessage('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ú©Ø§Ø±Ø¨Ø±: ' + errorMessage, 'error');
                        }).catch(err => {
                            showMessage('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ú©Ø§Ø±Ø¨Ø± (Ù¾ÛŒØ§Ù… Ù†Ø§Ù…Ø´Ø®Øµ)', 'error');
                            console.error('Error parsing error message:', err);
                        });
                    }
                })
                .catch(error => {
                    showMessage('âŒ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ Ø¯Ø± Ø­Ø°Ù Ú©Ø§Ø±Ø¨Ø±: ' + error.message, 'error');
                    console.error('Network error:', error);
                });
        }
    }

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù‡Ù†Ú¯Ø§Ù… Ù„ÙˆØ¯ Ø´Ø¯Ù† ØµÙØ­Ù‡
    window.onload = loadUsers;
</script>
</body>
</html>