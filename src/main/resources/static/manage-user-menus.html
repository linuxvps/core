<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>مدیریت منوهای کاربران</title>
</head>
<body>

<h2>مدیریت منوهای کاربران</h2>

<label>کاربر:</label>
<select id="userSelect" onchange="loadUserMenus()">
    <!-- با JS پر میشه -->
</select>

<h3>منوهای این کاربر</h3>
<ul id="userMenus"></ul>

<h3>افزودن منو به کاربر</h3>
<label>نام منو:</label>
<input type="text" id="menuTitle"><br>

<label>URL منو:</label>
<input type="text" id="menuUrl"><br>

<label>پرمیشن منو:</label>
<input type="text" id="menuPermission"><br>

<button onclick="addMenuToUser()">ثبت</button>

<script>
    function loadUsers() {
        fetch('/admin/users')
            .then(res => res.json())
            .then(data => {
                const select = document.getElementById('userSelect');
                select.innerHTML = '';
                data.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.id;
                    option.innerText = user.username;
                    select.appendChild(option);
                });
                if (data.length > 0) loadUserMenus(); // فقط اگه کاربر داریم
            });
    }

    function loadUserMenus() {
        const userId = document.getElementById('userSelect').value;
        fetch(`/api/user-menus/${userId}`)
            .then(res => res.json())
            .then(data => {
                const ul = document.getElementById('userMenus');
                ul.innerHTML = '';
                data.forEach(menu => {
                    const li = document.createElement('li');
                    li.innerText = `${menu.title} (${menu.url})`;
                    ul.appendChild(li);
                });
            });
    }

    function addMenuToUser() {
        const userId = document.getElementById('userSelect').value;
        const menu = {
            title: document.getElementById('menuTitle').value,
            url: document.getElementById('menuUrl').value,
            permission: document.getElementById('menuPermission').value
        };
        fetch(`/api/user-menus/${userId}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(menu)
        }).then(() => loadUserMenus());
    }

    window.onload = loadUsers;
</script>

</body>
</html>
